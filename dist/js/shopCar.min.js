define(["header","jquery","jquery-cookie"],function(header,$){function shopCar(){function carNum(){var cookieStr=$.cookie("goods"),cookieArr=eval(cookieStr),sum=0;if(cookieArr)for(var i=0;i<cookieArr.length;i++)sum+=cookieArr[i].num;$(".switch-cart-count").html(sum),$(".check-goods-num").html(sum),$(".toper .toper_right li:nth-child(4)").find("em").html(sum)}function carMsg(){$(".cart-list .cart-item-list").html(""),$.ajax({type:"get",url:"../data/list.json",success:function(arr){var cookieStr=$.cookie("goods");if(cookieStr){for(var cookieArr=eval(cookieStr),goodsArr=[],i=0;i<arr.length;i++)for(var j=0;j<cookieArr.length;j++)arr[i].id==cookieArr[j].id&&(arr[i].num=cookieArr[j].num,goodsArr.push(arr[i]));for(var prices=0,i=0;i<goodsArr.length;i++)$("<div class='item-list'><div class='item-item item-goods'><div class='item-form'><div class='cell p-goods'><a target='_blank' title="+goodsArr[i].title+" href="+goodsArr[i].url+"?id="+goodsArr[i].id+"><div class='img-box'><img alt="+goodsArr[i].title+" src="+goodsArr[i].img[0]+"></div></a><div class='p-txt'><a target='_blank' title="+goodsArr[i].title+" href="+goodsArr[i].url+"?id="+goodsArr[i].id+"><strong>"+goodsArr[i].title+"</strong></a></div></div><div class='cell p-props'><strong>¥<span class='goods-subtotal'>"+goodsArr[i].price+"</span></strong><div class='sales-promotion-box'></div></div><div class='cell p-quantity'><div class='quantity-form'><a class='decrement reduce-num' id="+goodsArr[i].id+">-</a><input class='itxt goods-num' type='text' value="+goodsArr[i].num+"><a class='increment add-num' id="+goodsArr[i].id+">+</a></div><p>有货</p></div><div class='cell p-sum'><strong>¥<span class='goods-subtotal'>"+parseInt(goodsArr[i].price)*parseInt(goodsArr[i].num)+".00</span></strong></div><div class='cell p-ops'><p><a class='del' id="+goodsArr[i].id+">删除</a></p></div></div></div><div class='full-gift'></div></div>").appendTo($(".cart-list .cart-item-list")),prices+=parseInt(goodsArr[i].price)*parseInt(goodsArr[i].num);$(".check-goods-total").html(prices+".00")}else $(".check-goods-total").html("0.00")},error:function(i){console.log(i)}})}carNum(),carMsg(),$(".cart-item-list").on("click",".item-list .del",function(){for(var id=this.id,cookieStr=$.cookie("goods"),cookieArr=eval(cookieStr),goodsArr=[],i=0;i<cookieArr.length;i++)id!=cookieArr[i].id&&goodsArr.push(cookieArr[i]);$.cookie("goods",JSON.stringify(goodsArr),{expires:7,path:"/"}),carNum(),carMsg()}),$(".cart_floatbar .cart_toolbar .remove_shop").click(function(){$.cookie("goods",null,{path:"/"}),carNum(),carMsg()}),$(".cart-item-list").on("click",".add-num",function(){for(var id=this.id,cookieStr=$.cookie("goods"),cookieArr=eval(cookieStr),goodsArr=[],i=0;i<cookieArr.length;i++)id==cookieArr[i].id&&cookieArr[i].num++;$.cookie("goods",JSON.stringify(cookieArr),{expires:7,path:"/"}),carNum(),carMsg()}),$(".cart-item-list").on("click",".reduce-num",function(){for(var id=this.id,cookieStr=$.cookie("goods"),cookieArr=eval(cookieStr),i=0;i<cookieArr.length;i++)id==cookieArr[i].id&&(cookieArr[i].num<=1?cookieArr[i].num=1:cookieArr[i].num--);$.cookie("goods",JSON.stringify(cookieArr),{expires:7,path:"/"}),carNum(),carMsg()}),$.ajax({type:"get",url:"../data/list.json",success:function(i){if(i){for(var r=0;r<i.length;r++)if(r<5){for(var o=$("<div class='list_item'></div>"),s=$("<div class='list_img'></div>"),e=$("<a href="+i[r].url+"?id="+i[r].id+"></a>"),t=$("<ul></ul>"),l=0;l<i[r].img.length;l++)$("<li><img src="+i[r].img[l]+" alt="+i[r].title+" title="+i[r].title+"></li>").appendTo(t);t.appendTo(e),e.appendTo(s);var a=$("<div class='list_imgx'></div>"),c=$("<ol></ol>");for(l=0;l<i[r].imgx.length;l++)$("<li><img src="+i[r].imgx[l]+" alt="+i[r].title+" title="+i[r].title+"></li>").appendTo(c);c.appendTo(a),$("<span class='prev'>&lt;</span><span class='next'>&gt;</span>").appendTo(a),a.appendTo(s),s.appendTo(o),$("<a href="+i[r].url+"?id="+i[r].id+"><ul class='list_con'><li><span>"+i[r].price+"</span><i>"+i[r].del+"</i></li><li><p>"+i[r].title+"</p></li><li><em>"+i[r].evaluate+"</em></li><li><em>"+i[r].merchant+"</em></li></ul></a>").appendTo(o),o.appendTo($(".liker_list"))}$(".list_img ul li").eq(0).show().siblings().hide();var d=0;$(".list_imgx ol").on("mouseenter","li",function(){d=$(this).index(),$(this).attr("class","active").siblings().attr("class",""),$(this).parent().parent().prev().find("ul li").eq(d).show().siblings().hide()}),$(".prev").click(function(){--d<0&&(d=0);var i=($(this).prev().find("li").width()+6)*$(this).prev().find("li").size(),r=$(this).prev().find("li").size()-5,o=parseInt($(this).prev().css("left"));$(this).prev().width(i),d<=r&&o<0&&$(this).prev().stop().animate({left:o+$(this).prev().find("li").width()},500),$(this).prev().find("li").eq(d).attr("class","active").siblings().attr("class",""),$(this).parent().prev().find("ul li").eq(d).show().siblings().hide()}),$(".next").click(function(){++d>$(this).parent().prev().find("ul li").size()&&(d=$(this).parent().prev().find("ul li").size());var i=($(this).prev().prev().find("li").width()+6)*$(this).prev().prev().find("li").size();$(this).prev().prev().width(i),5<=d&&$(this).prev().prev().stop().animate({left:-$(this).prev().prev().find("li").width()},500),$(this).prev().prev().find("li").eq(d).attr("class","active").siblings().attr("class",""),$(this).parent().prev().find("ul li").eq(d).show().siblings().hide()})}},error:function(i){console.log(i)}})}return{shopCar:shopCar}});